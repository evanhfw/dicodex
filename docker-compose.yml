services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: student-dashboard-frontend
    ports:
      - "8080:8080"
    depends_on:
      - backend
    restart: unless-stopped

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: student-dashboard-backend
    # No port exposed â€” accessed via Nginx reverse proxy on internal network
    environment:
      - SELENIUM_URL=http://selenium:4444
      - CODINGCAMP_URL=https://codingcamp.dicoding.com
      - API_KEY=${API_KEY}
      - REDIS_URL=redis://redis:6379
    volumes:
      - scraped_data:/app/output
    depends_on:
      - selenium
      - redis
    restart: unless-stopped

  worker:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: student-dashboard-worker
    command: uv run python -m app.run_worker
    environment:
      - SELENIUM_URL=http://selenium:4444
      - CODINGCAMP_URL=https://codingcamp.dicoding.com
      - REDIS_URL=redis://redis:6379
    volumes:
      - scraped_data:/app/output
    depends_on:
      - selenium
      - redis
    restart: unless-stopped

  redis:
    image: redis:alpine
    container_name: student-dashboard-redis
    volumes:
      - redis_data:/data
    restart: unless-stopped

  selenium:
    image: selenium/standalone-chrome:latest
    container_name: student-dashboard-selenium
    ports:
      - "4444:4444"
      - "7900:7900"  # VNC server for debugging
    shm_size: 2gb
    environment:
      - SE_NODE_MAX_SESSIONS=5
      - SE_NODE_SESSION_TIMEOUT=300
    restart: unless-stopped

volumes:
  scraped_data:
    name: student_dashboard_data
  redis_data:
    name: student_dashboard_redis
